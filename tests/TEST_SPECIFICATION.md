# Buddy-AI 功能测试规范

## 测试范围

本规范涵盖了 Buddy-AI v2.0 的所有主要功能模块的测试用例。

## 测试环境

### 软件环境
- 操作系统: Windows 10 / macOS / Linux
- 浏览器: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- Node.js: 18.0+
- Python: 3.9+

### 硬件环境
- 桌面端: 1920x1080, 1366x768
- 移动端: 375x667, 414x896

## 测试分类

### 1. 消息发送和显示测试

#### 1.1 用户消息显示
```
测试ID: TC-1.1
测试标题: 用户消息靠右显示
优先级: P1
前置条件: 用户已登录并进入聊天界面
测试步骤:
  1. 在输入框中输入测试消息 "你好"
  2. 点击发送按钮或按Enter键发送
  3. 检查消息是否靠右显示
预期结果:
  - 用户消息靠右显示
  - 显示用户头像 (👤)
  - 显示用户名称 "用户"
  - 消息样式正确（气泡、颜色等）
```

#### 1.2 AI消息显示
```
测试ID: TC-1.2
测试标题: AI消息靠左显示
优先级: P1
前置条件: 用户发送消息后等待AI响应
测试步骤:
  1. 发送一条消息 "介绍一下自己"
  2. 等待AI响应
  3. 检查AI消息是否靠左显示
预期结果:
  - AI消息靠左显示
  - 显示机器人头像 (🤖)
  - 显示机器人名称 "Buddy-AI"
  - 消息样式正确
```

#### 1.3 Markdown渲染
```
测试ID: TC-1.3
测试标题: Markdown格式正确渲染
优先级: P1
前置条件: AI响应包含Markdown格式内容
测试步骤:
  1. 询问需要格式化回答的问题 "请用列表形式介绍三种编程语言"
  2. 检查响应中的Markdown是否正确渲染
预期结果:
  - 标题 (h1-h6) 正确显示
  - 无序列表和有序列表正确显示
  - 代码块有语法高亮
  - 引用块正确显示
  - 链接可点击
  - 表格格式正确
```

#### 1.4 长文本换行
```
测试ID: TC-1.4
测试标题: 长文本正确换行
优先级: P2
前置条件: 发送或接收长文本内容
测试步骤:
  1. 输入或接收超过800px宽度的长文本
  2. 检查文本是否正确换行
预期结果:
  - 长文本正确换行
  - 不溢出消息容器
  - 行高适中 (1.6)
  - 保持可读性
```

### 2. 文件上传功能测试

#### 2.1 文件格式支持
```
测试ID: TC-2.1
测试标题: 支持多种文件格式
优先级: P0
前置条件: 打开文件上传模态框
测试步骤:
  1. 点击侧边栏"上传文件"按钮
  2. 分别上传以下格式的文件: pdf, docx, txt, md, csv
  3. 检查每种格式是否能正常上传
预期结果:
  - PDF 文件可以上传
  - DOCX 文件可以上传
  - TXT 文件可以上传
  - MD 文件可以上传
  - CSV 文件可以上传
```

#### 2.2 文件大小限制
```
测试ID: TC-2.2
测试标题: 文件大小限制
优先级: P0
前置条件: 准备测试文件
测试步骤:
  1. 尝试上传 4.5MB 的文件（应成功）
  2. 尝试上传 5.5MB 的文件（应失败）
  3. 检查是否收到正确错误提示
预期结果:
  - 4.5MB 文件上传成功
  - 5.5MB 文件被拒绝
  - 显示错误提示："文件大小超过限制 (5MB)"
```

#### 2.3 不支持的文件格式
```
测试ID: TC-2.3
测试标题: 不支持的文件格式提示
优先级: P1
前置条件: 打开文件上传模态框
测试步骤:
  1. 尝试上传 .exe 文件
  2. 尝试上传 .zip 文件
  3. 尝试上传 .jpg 文件
  4. 检查错误提示
预期结果:
  - 不支持的格式被拒绝
  - 显示错误提示
  - 列出支持的格式
```

#### 2.4 文件状态显示
```
测试ID: TC-2.4
测试标题: 文件上传状态显示
优先级: P2
前置条件: 选择并上传文件
测试步骤:
  1. 选择文件并上传
  2. 观察文件列表中的状态显示
  3. 点击"向量化"按钮
  4. 观察状态变化
预期结果:
  - 上传成功后显示"已上传"
  - 向量化后显示"已向量化"
  - 失败时显示"失败"
  - 不同状态有不同颜色标识
```

### 3. 侧边栏功能测试

#### 3.1 侧边栏收缩/展开
```
测试ID: TC-3.1
测试标题: 侧边栏收缩/展开动画
优先级: P2
前置条件: 侧边栏显示
测试步骤:
  1. 点击收缩按钮（◀）
  2. 观察动画效果
  3. 点击展开按钮（▶）
  4. 观察动画效果
预期结果:
  - 收缩动画流畅 (0.3s)
  - 收缩后只显示图标
  - 展开动画流畅
  - 展开后显示完整内容
```

#### 3.2 收缩状态显示
```
测试ID: TC-3.2
测试标题: 收缩状态内容显示
优先级: P2
前置条件: 侧边栏收缩
测试步骤:
  1. 收缩侧边栏
  2. 检查各部分内容显示
预期结果:
  - 只显示应用图标
  - 会话列表只显示会话图标
  - 功能按钮只显示图标
  - 隐藏所有文字说明
```

#### 3.3 用户偏好保存
```
测试ID: TC-3.3
测试标题: 用户偏好持久化
优先级: P2
前置条件: 调整侧边栏状态
测试步骤:
  1. 收缩侧边栏
  2. 刷新页面
  3. 检查状态是否保持
预期结果:
  - 刷新后侧边栏仍保持收缩状态
  - 用户偏好被保存到本地存储
```

### 4. 知识库管理测试

#### 4.1 文件列表显示
```
测试ID: TC-4.1
测试标题: 显示已上传文件列表
优先级: P1
前置条件: 已上传文件
测试步骤:
  1. 打开文件上传模态框
  2. 查看已上传文件列表
预期结果:
  - 显示所有已上传文件
  - 每个文件显示文件名
  - 每个文件显示文件大小
  - 每个文件显示当前状态
```

#### 4.2 文件向量化
```
测试ID: TC-4.2
测试标题: 文件向量化功能
优先级: P0
前置条件: 文件已上传
测试步骤:
  1. 选择已上传的文件
  2. 点击"向量化"按钮
  3. 检查向量化结果
预期结果:
  - 向量化请求发送成功
  - 显示生成的chunk数量
  - 文件状态更新为"已向量化"
```

#### 4.3 文件删除
```
测试ID: TC-4.3
测试标题: 文件删除功能
优先级: P1
前置条件: 文件已上传
测试步骤:
  1. 选择要删除的文件
  2. 调用删除API
  3. 检查文件是否从列表移除
预期结果:
  - 文件成功删除
  - 从文件列表中移除
  - 后端文件也被删除
```

#### 4.4 文件信息准确性
```
测试ID: TC-4.4
测试标题: 文件信息显示准确
优先级: P2
前置条件: 文件上传成功
测试步骤:
  1. 上传一个已知文件
  2. 检查显示的文件信息
预期结果:
  - 文件名正确
  - 文件大小正确
  - 上传时间正确
  - 文件ID唯一
```

### 5. 响应式布局测试

#### 5.1 桌面端适配
```
测试ID: TC-5.1
测试标题: 桌面端不同分辨率适配
优先级: P2
前置条件: 在桌面浏览器中测试
测试步骤:
  1. 测试 1920x1080 分辨率
  2. 测试 1366x768 分辨率
  3. 测试 2560x1440 分辨率
预期结果:
  - 各分辨率下布局正常
  - 侧边栏宽度一致
  - 消息区域自适应
  - 不出现横向滚动条
```

#### 5.2 平板端适配
```
测试ID: TC-5.2
测试标题: 平板端适配
优先级: P2
前置条件: 在平板设备或模拟器中测试
测试步骤:
  1. 测试 768x1024 分辨率
  2. 测试 1024x768 分辨率
预期结果:
  - 布局正常适配
  - 触摸操作流畅
  - 字体大小适中
```

#### 5.3 移动端适配
```
测试ID: TC-5.3
测试标题: 移动端适配
优先级: P1
前置条件: 在移动设备或模拟器中测试
测试步骤:
  1. 测试 375x667 分辨率
  2. 测试 414x896 分辨率
  3. 测试竖屏和横屏
预期结果:
  - 侧边栏可收缩或全屏显示
  - 消息区域占据主要空间
  - 输入框在底部
  - 触摸目标足够大
```

### 6. WebSocket通信测试

#### 6.1 连接建立
```
测试ID: TC-6.1
测试标题: WebSocket连接建立
优先级: P0
前置条件: 后端服务已启动
测试步骤:
  1. 打开前端应用
  2. 检查WebSocket连接状态
预期结果:
  - WebSocket连接成功建立
  - 连接状态显示为已连接
  - 控制台无错误信息
```

#### 6.2 消息发送
```
测试ID: TC-6.2
测试标题: 发送用户消息
优先级: P0
前置条件: WebSocket已连接
测试步骤:
  1. 输入消息内容
  2. 点击发送按钮
  3. 检查消息是否发送
预期结果:
  - 消息显示在聊天界面
  - 消息正确发送到后端
  - 发送状态正确
```

#### 6.3 流式响应
```
测试ID: TC-6.3
测试标题: 接收流式响应
优先级: P0
前置条件: 已发送消息
测试步骤:
  1. 发送消息
  2. 观察响应过程
预期结果:
  - 显示加载动画
  - 逐步显示响应内容
  - 最终显示完整响应
```

#### 6.4 自动重连
```
测试ID: TC-6.4
测试标题: WebSocket自动重连
优先级: P1
前置条件: WebSocket已连接
测试步骤:
  1. 断开网络连接
  2. 等待连接断开
  3. 恢复网络连接
  4. 观察是否自动重连
预期结果:
  - 检测到连接断开
  - 自动尝试重连（最多5次）
  - 重连成功后恢复功能
```

### 7. 会话管理测试

#### 7.1 创建新会话
```
测试ID: TC-7.1
测试标题: 创建新会话
优先级: P1
前置条件: 用户已登录
测试步骤:
  1. 点击"新对话"按钮
  2. 检查是否创建新会话
预期结果:
  - 新会话创建成功
  - 分配唯一thread_id
  - 会话列表显示新会话
  - 消息区域清空
```

#### 7.2 切换会话
```
测试ID: TC-7.2
测试标题: 切换会话
优先级: P1
前置条件: 有多个会话
测试步骤:
  1. 点击侧边栏中的其他会话
  2. 检查是否切换成功
预期结果:
  - 切换到目标会话
  - 当前会话高亮显示
  - 显示会话历史消息
```

#### 7.3 删除会话
```
测试ID: TC-7.3
测试标题: 删除会话
优先级: P2
前置条件: 有多个会话
测试步骤:
  1. 点击会话的删除按钮
  2. 确认删除
  3. 检查是否删除成功
预期结果:
  - 会话从列表中移除
  - 如果是当前会话，清空消息区域
  - 显示确认提示
```

#### 7.4 会话标题更新
```
测试ID: TC-7.4
测试标题: 会话标题自动更新
优先级: P2
前置条件: 新会话无标题
测试步骤:
  1. 在新会话中发送第一条消息
  2. 检查会话标题
预期结果:
  - 会话标题自动设置为消息前30字
  - 标题显示在侧边栏
```

### 8. 调试功能测试

#### 8.1 调试面板显示
```
测试ID: TC-8.1
测试标题: 调试面板开关
优先级: P3
前置条件: 侧边栏显示
测试步骤:
  1. 点击"调试面板"按钮
  2. 检查调试面板是否显示
  3. 再次点击关闭
预期结果:
  - 调试面板正常显示
  - 可以正常关闭
  - 状态正确切换
```

#### 8.2 调试信息显示
```
测试ID: TC-8.2
测试标题: 调试信息详细程度
优先级: P3
前置条件: 调试面板已打开
测试步骤:
  1. 发送一条消息
  2. 查看调试面板
预期结果:
  - 显示消息类型（HumanMessage/AIMessage/ToolMessage）
  - 显示工具调用信息
  - 显示消息内容
  - 可以展开查看详情
```

#### 8.3 清除调试信息
```
测试ID: TC-8.3
测试标题: 清除调试信息
优先级: P3
前置条件: 调试面板有信息
测试步骤:
  1. 点击"清除调试信息"按钮
  2. 检查调试面板
预期结果:
  - 所有调试信息被清除
  - 调试面板显示"暂无调试信息"
```

## 性能测试

### P-1: 响应时间
```
测试目标: 验证系统响应时间在可接受范围内
测试步骤:
  1. 测量WebSocket连接时间
  2. 测量消息响应时间
  3. 测量文件上传时间

预期结果:
  - WebSocket连接时间 < 1s
  - 消息响应时间 < 5s
  - 文件上传时间与文件大小成正比
```

### P-2: 并发性能
```
测试目标: 验证系统并发能力
测试步骤:
  1. 模拟10个用户同时连接
  2. 模拟10个用户同时发送消息
  3. 模拟5个用户同时上传文件

预期结果:
  - 所有连接成功建立
  - 消息正确响应
  - 文件上传成功
```

### P-3: 资源占用
```
测试目标: 验证客户端资源占用合理
测试步骤:
  1. 测量页面初始内存占用
  2. 发送100条消息后测量
  3. 上传10个文件后测量

预期结果:
  - 初始内存占用 < 50MB
  - 100条消息后 < 100MB
  - 无明显内存泄漏
```

## 兼容性测试

### C-1: 浏览器兼容性
```
测试目标: 验证主流浏览器兼容性
测试范围:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+

预期结果: 所有浏览器核心功能正常
```

### C-2: 设备兼容性
```
测试目标: 验证不同设备兼容性
测试范围:
  - 桌面设备（Windows, macOS, Linux）
  - 平板设备（iPad, Android平板）
  - 手机设备（iPhone, Android手机）

预期结果: 所有设备核心功能正常
```

## 安全测试

### S-1: 输入验证
```
测试目标: 验证输入验证机制
测试步骤:
  1. 尝试发送HTML标签
  2. 尝试发送JavaScript代码
  3. 尝试上传恶意文件

预期结果:
  - HTML标签被转义
  - JavaScript不执行
  - 恶意文件被拒绝
```

### S-2: 文件安全
```
测试目标: 验证文件上传安全性
测试步骤:
  1. 尝试上传.exe文件
  2. 尝试上传超过限制大小的文件
  3. 尝试上传伪装文件

预期结果:
  - 不支持格式被拒绝
  - 超大文件被拒绝
  - 伪装文件被识别
```

## 测试流程

1. **测试准备**
   - 搭建测试环境
   - 准备测试数据
   - 配置测试工具

2. **执行测试**
   - 按照测试用例执行
   - 记录测试结果
   - 收集错误信息

3. **缺陷报告**
   - 记录发现的缺陷
   - 分配优先级
   - 提交给开发团队

4. **回归测试**
   - 验证缺陷修复
   - 确认无回归问题
   - 更新测试报告

## 测试工具

- **前端测试**: Vitest, Vue Test Utils
- **E2E测试**: Playwright
- **性能测试**: Lighthouse
- **API测试**: Postman
- **浏览器兼容性**: BrowserStack

## 术语表

| 术语 | 说明 |
|-----|------|
| WebSocket | 全双工通信协议，用于实时聊天 |
| RAG | 检索增强生成，AI问答架构 |
| Markdown | 轻量级标记语言，用于格式化文本 |
| Vectorize | 向量化，将文本转换为向量表示 |
| Thread | 会话线程，表示一次对话会话 |
| Chunk | 文本块，文档被分割的小段文本 |
| Pinia | Vue3状态管理库 |
| Vite | 现代化前端构建工具 |

## 参考资料

- [Buddy-AI 架构文档](../ARCHITECTURE.md)
- [前端开发文档](../frontend/README.md)
- [后端API文档](../backend/README.md)
- [集成测试指南](./INTEGRATION_TEST.md)

---

文档版本: 1.0
最后更新: 2026-02-26
维护者: Buddy-AI 团队